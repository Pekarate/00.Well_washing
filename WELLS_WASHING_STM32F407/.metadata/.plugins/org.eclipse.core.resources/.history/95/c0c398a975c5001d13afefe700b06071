/*
 * dw_display.c
 *
 *  Created on: Mar 18, 2023
 *      Author: ADMIN
 */


#include "main.h"
#include "uart.h"
#include "string.h"
#include "data.h"

uint8_t	current_rx_index = 0;
uint8_t *dw_rx_buf[10] = {0};

static inline void Dw_write(uint8_t *data,uint16_t len)
{
	uart_transmit_block(data, len, 1000);
}
int Dwin_Write_VP(uint16_t Addr,uint8_t *data,uint16_t len)
{
	uint8_t DwinBuf[100];
	DwinBuf[0]= 0x5A;
	DwinBuf[1]= 0xA5;
	DwinBuf[2]= (len+1)*2 +1;  //
	DwinBuf[3]= 0x82;
	DwinBuf[4]= Addr>>8;
	DwinBuf[5]= Addr;
	for(int i=0;i<len;i++)
	{
		DwinBuf[6+i*2] = data[i*2];
		DwinBuf[6+i*2+1] = data[i*2+1];
	}
    len = (len+1)*2 +4;
    Dwin_write(DwinBuf, len);
	return 1;
}
int dw_process_rx_buffer(uint8_t *data,uint16_t size){
	if(size < 5){
		return -1;
	}
	if(data[0] != 0x5A && data[1] != 0xA5 ){
		return -2;
	}
	uint16_t code = data[4];
	code = code*256+ data[5];
	switch (code) {
		case value:

			break;
		default:
			break;
	}
	return 1;
}

int dw_update_step_numbers(void){
//	uint8_t tx[100] = {0x5a,0xa5,23,0x82,0x20,0x00};
//	for(int i=0;i<10;i++)
//	{
//		tx[6+i*2] = 0;
//		tx[6+i*2+1] = system_data.pg_stepnumber[i];
//	}
//	uart_transmit_block(tx, 26, 1000);
	Dwin_Write_VP(0x2000)
	return 1;
}

void process_data_rx_uart()
{

}
