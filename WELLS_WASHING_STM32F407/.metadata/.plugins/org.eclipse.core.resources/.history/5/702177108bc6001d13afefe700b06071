/*
 * motor.h
 *
 *  Created on: Mar 19, 2023
 *      Author: ADMIN
 */

#ifndef INC_MOTOR_H_
#define INC_MOTOR_H_

#include "main.h"
#include "stdint.h"
#include "motor.h"

#define STEP_LOSS 2

typedef enum
{
	DIR_FORWARD = 0,
	DIR_BACKWARD
}_motor_dir;

typedef enum
{
	MT_STATE_IDLE = 0,
	MT_STATE_START,
	MT_STATE_RUNING,
	MT_STATE_STTOP
}_motor_state;

typedef struct{
	uint32_t ud_time; // for display position 2 time diffrent 2 ms
	uint32_t old_pos; // for check is position changed
	uint32_t current_pos;
	uint32_t next_pos;
	_motor_dir current_dir;
	_motor_state state;
	int (*is_mt_home_pos)(void);
	void (*mt_set_dir)(_motor_dir);
	void (*mt_move_to_pos)(uint32_t);
	void (*mt_start)();
	void (*mt_stop)();
}_motor_typedef;

extern _motor_typedef x_motor,z_motor;

void x_step_mt_int(void);
void x_step_motor_process(void);
int dw_update_steper_positon(_motor_typedef *st_motor);
void x_step_mt_move_foward(_motor_typedef *step,uint32_t numstep);
void x_step_mt_move_backward(_motor_typedef *step,uint32_t numstep);


#endif /* INC_MOTOR_H_ */
